var M=Object.create;var d=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var q=Object.getPrototypeOf,$=Object.prototype.hasOwnProperty;var O=r=>d(r,"__esModule",{value:!0});var D=(r,n)=>{O(r);for(var t in n)d(r,t,{get:n[t],enumerable:!0})},F=(r,n,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of _(n))!$.call(r,o)&&o!=="default"&&d(r,o,{get:()=>n[o],enumerable:!(t=k(n,o))||t.enumerable});return r},m=r=>F(O(d(r!=null?M(q(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);D(exports,{cleanCodeForParsing:()=>T,clearCacheUp:()=>v,create:()=>V,createEmitter:()=>R,findTopmostParents:()=>y,getChildrenModuleIds:()=>j,remove:()=>g,resolveAliases:()=>A,walk:()=>p});var E=m(require("fs")),h=m(require("path")),C=m(require("module")),x=m(require("es-module-lexer")),P=m(require("strip-comments")),b=m(require("filewatcher")),w=m(require("lodash")),S=/(?<![^;\n])[ ]*import(?:["'\s]*([\w*${}\n\r\t, ]+)\s*from\s*)?\s*["'](.*?)["']/gm,G=/(?<!\.)\bimport\((?:['"].+['"]|`[^$]+`)\)/gm;function R(){let r={};function n(i,c){r[i]&&r[i].forEach(e=>e(c)),r["*"]&&r["*"].forEach(e=>e(c))}function t(i,c){return r[i]=r[i]?r[i].concat(c):[c],()=>{r[i].splice(r[i].indexOf(c),1)}}function o(){r={}}function s(i){return r[i]||[]}return{clear:o,emit:n,on:t,listeners:s}}function A(r,n={}){for(let t of Object.keys(n))if(r.indexOf(t)===0)return(n[t]+r.replace(t,"")).replace(/\/+/g,"/");return r}function T(r){r=(0,P.default)(r);let n=[],t,o=new RegExp(S);for(;t=o.exec(r);)n.push(t);let s=new RegExp(G);for(;t=s.exec(r);)n.push(t);return n.map(([i])=>i).join(`
`)}async function j(r,n={}){let t=E.default.readFileSync(r,"utf-8"),o=[];try{o=(await(0,x.parse)(t))[0].map(s=>s.n)}catch{o=(await(0,x.parse)(T(t)))[0].map(i=>i.n)}return o.map(s=>{let i=(0,C.createRequire)(r),c;try{c=i.resolve(s)}catch{try{c=i.resolve(A(s,n.alias))}catch{c=require.resolve(s)}}return c===s?void 0:c}).filter(Boolean)}async function p(r,n,t={}){let o=/^\.(j|t)sx?$/.test(h.default.extname(r));n[r]=n[r]||{entry:!0,parents:[],children:[]};let s=n[r].children,i=o?await j(r,t):[],c=(0,w.difference)(s,i);for(let e of c)n[e].parents.splice(n[e].parents.indexOf(r),1),!n[e].parents.length&&!n[e].entry&&g(e,n);n[r].children=i;for(let e of n[r].children)n[e]=n[e]||{entry:!1,parents:[],children:[]},!n[e].parents.includes(r)&&(n[e].parents.push(r),await p(e,n,t));return n}function g(r,n){let{parents:t,children:o}=n[r];for(let s of t)n[s].children.splice(n[s].children.indexOf(r),1);for(let s of o)!n[s]||(n[s].parents.splice(n[s].parents.indexOf(r),1),n[s].parents.length||g(s,n));delete n[r]}function v(r,n){delete require.cache[r];for(let t of n[r].parents)v(t,n)}function y(r,n,t=[]){if(t.includes(r))return t;let{entry:o,parents:s}=n[r];o&&t.push(r);for(let i of s)y(i,n,t);return t}function V(r={}){let n={},t=(0,b.default)(),o=R();function s(e){o.emit("error",e),o.listeners("error").length||console.error(e)}function i(e){return h.default.isAbsolute(e)?!0:(s(`Cannot add or remove relative path ${e}`),!1)}async function c(e){let a=t.list();if(a.includes(e))return;t.add(e);let l=Date.now();await new Promise((f,u)=>{let I=setInterval(()=>{t.list().length>a.length&&(clearInterval(I),f(!0)),Date.now()-l>2e3&&u(!1)},10)})}return t.on("change",async(e,a)=>{if(v(e,n),a.deleted){n[e].entry?o.emit("remove",[e]):o.emit("change",y(e,n)),t.remove(e);try{g(e,n)}catch(f){s(f)}}else{let l=Object.keys(n);try{await p(e,n,r)}catch(u){s(u)}let f=Object.keys(n);(0,w.difference)(l,f).forEach(u=>t.remove(u)),await Promise.all(f.map(c)),o.emit("change",y(e,n))}}),{get tree(){return Object.assign({},n)},on(e,a){return o.on(e,a)},onAdd(e){return o.on("add",e)},onRemove(e){return o.on("remove",e)},onChange(e){return o.on("change",e)},onError(e){return o.on("error",e)},close(){o.clear(),t.removeAll()},async add(e){let a=[].concat(e).filter(l=>!n[l]&&i(l));if(!!a.length){for(let l of a)try{await p(l,n,r)}catch(f){s(f)}await Promise.all(Object.keys(n).map(c)),o.emit("add",a)}},remove(e){let a=[].concat(e).filter(l=>n[l]&&i(l));for(let l of a)!n[l].entry||g(l,n);o.emit("remove",a)}}}0&&(module.exports={cleanCodeForParsing,clearCacheUp,create,createEmitter,findTopmostParents,getChildrenModuleIds,remove,resolveAliases,walk});
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vaW5kZXgudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImltcG9ydCBmcyBmcm9tICdmcydcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnXG5pbXBvcnQgeyBjcmVhdGVSZXF1aXJlIH0gZnJvbSAnbW9kdWxlJ1xuaW1wb3J0IHsgcGFyc2UgfSBmcm9tICdlcy1tb2R1bGUtbGV4ZXInXG4vLyBAdHMtaWdub3JlXG5pbXBvcnQgc3RyaXBDb21tZW50cyBmcm9tICdzdHJpcC1jb21tZW50cydcbi8vIEB0cy1pZ25vcmVcbmltcG9ydCBmaWxld2F0Y2hlciBmcm9tICdmaWxld2F0Y2hlcidcbmltcG9ydCB7IGRpZmZlcmVuY2UgfSBmcm9tICdsb2Rhc2gnXG5cbmV4cG9ydCB0eXBlIEFsaWFzID0geyBbYWxpYXM6IHN0cmluZ106IHN0cmluZyB9XG5cbmV4cG9ydCB0eXBlIE9wdGlvbnMgPSB7XG4gIGFsaWFzPzogQWxpYXNcbn1cblxuZXhwb3J0IHR5cGUgVHJlZSA9IHtcbiAgW2ZpbGVuYW1lOiBzdHJpbmddOiB7XG4gICAgZW50cnk6IGJvb2xlYW5cbiAgICBwYXJlbnRzOiBzdHJpbmdbXVxuICAgIGNoaWxkcmVuOiBzdHJpbmdbXVxuICB9XG59XG5cbmNvbnN0IEVTTV9JTVBPUlRfUkVHRVggPSAvKD88IVteO1xcbl0pWyBdKmltcG9ydCg/OltcIidcXHNdKihbXFx3KiR7fVxcblxcclxcdCwgXSspXFxzKmZyb21cXHMqKT9cXHMqW1wiJ10oLio/KVtcIiddL2dtXG5jb25zdCBFU01fRFlOQU1JQ19JTVBPUlRfUkVHRVggPSAvKD88IVxcLilcXGJpbXBvcnRcXCgoPzpbJ1wiXS4rWydcIl18YFteJF0rYClcXCkvZ21cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUVtaXR0ZXIoKSB7XG4gIGxldCBldmVudHM6IHsgW2V2ZW50OiBzdHJpbmddOiBhbnlbXSB9ID0ge31cblxuICBmdW5jdGlvbiBlbWl0KGV2ZW50OiBzdHJpbmcsIGRhdGE/OiBhbnkpOiB2b2lkIHtcbiAgICBpZiAoZXZlbnRzW2V2ZW50XSkgZXZlbnRzW2V2ZW50XS5mb3JFYWNoKChoYW5kbGVyKSA9PiBoYW5kbGVyKGRhdGEpKVxuICAgIGlmIChldmVudHNbJyonXSkgZXZlbnRzWycqJ10uZm9yRWFjaCgoaGFuZGxlcikgPT4gaGFuZGxlcihkYXRhKSlcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uKGV2ZW50OiBzdHJpbmcsIGhhbmRsZXI6IGFueSkge1xuICAgIGV2ZW50c1tldmVudF0gPSBldmVudHNbZXZlbnRdID8gZXZlbnRzW2V2ZW50XS5jb25jYXQoaGFuZGxlcikgOiBbaGFuZGxlcl1cbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgZXZlbnRzW2V2ZW50XS5zcGxpY2UoZXZlbnRzW2V2ZW50XS5pbmRleE9mKGhhbmRsZXIpLCAxKVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGNsZWFyKCkge1xuICAgIGV2ZW50cyA9IHt9XG4gIH1cblxuICBmdW5jdGlvbiBsaXN0ZW5lcnMoZXZlbnQ6IHN0cmluZykge1xuICAgIHJldHVybiBldmVudHNbZXZlbnRdIHx8IFtdXG4gIH1cblxuICByZXR1cm4ge1xuICAgIGNsZWFyLFxuICAgIGVtaXQsXG4gICAgb24sXG4gICAgbGlzdGVuZXJzLFxuICB9XG59XG5cbi8qXG4gKiBTaW1wbGUgYWxpYXMgcmVzb2x2ZXIgaS5lLlxuICpcbiAqICAgIHtcbiAqICAgICAgJ0AnOiBwcm9jZXNzLmN3ZCgpXG4gKiAgICB9XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZXNvbHZlQWxpYXNlcyhmaWxlcGF0aDogc3RyaW5nLCBhbGlhczogQWxpYXMgPSB7fSkge1xuICBmb3IgKGNvbnN0IGEgb2YgT2JqZWN0LmtleXMoYWxpYXMpKSB7XG4gICAgaWYgKGZpbGVwYXRoLmluZGV4T2YoYSkgPT09IDApIHtcbiAgICAgIC8vIFRPRE8gc3VwcG9ydCB3aW5kb3dzIHdpdGggcGF0aC5zZXAoKVxuICAgICAgcmV0dXJuIChhbGlhc1thXSArIGZpbGVwYXRoLnJlcGxhY2UoYSwgJycpKS5yZXBsYWNlKC9cXC8rL2csICcvJylcbiAgICB9XG4gIH1cblxuICByZXR1cm4gZmlsZXBhdGhcbn1cblxuLyoqXG4gKiBMaWZ0ZWQgZnJvbSBzbm93cGFjaywgcHJvcHMgdG8gdGhlaXIgdGVhbVxuICpcbiAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3Nub3dwYWNranMvc25vd3BhY2svYmxvYi9mNzVkZTEzNzVmZTE0MTU1Njc0MTEyZDg4YmYyMTFjYTM3MjFhYzdjL3Nub3dwYWNrL3NyYy9zY2FuLWltcG9ydHMudHMjTDExOVxuICovXG5leHBvcnQgZnVuY3Rpb24gY2xlYW5Db2RlRm9yUGFyc2luZyhjb2RlOiBzdHJpbmcpIHtcbiAgY29kZSA9IHN0cmlwQ29tbWVudHMoY29kZSlcbiAgY29uc3QgYWxsTWF0Y2hlcyA9IFtdXG4gIGxldCBtYXRjaFxuICBjb25zdCBpbXBvcnRSZWdleCA9IG5ldyBSZWdFeHAoRVNNX0lNUE9SVF9SRUdFWClcbiAgd2hpbGUgKChtYXRjaCA9IGltcG9ydFJlZ2V4LmV4ZWMoY29kZSkpKSB7XG4gICAgYWxsTWF0Y2hlcy5wdXNoKG1hdGNoKVxuICB9XG4gIGNvbnN0IGR5bmFtaWNJbXBvcnRSZWdleCA9IG5ldyBSZWdFeHAoRVNNX0RZTkFNSUNfSU1QT1JUX1JFR0VYKVxuICB3aGlsZSAoKG1hdGNoID0gZHluYW1pY0ltcG9ydFJlZ2V4LmV4ZWMoY29kZSkpKSB7XG4gICAgYWxsTWF0Y2hlcy5wdXNoKG1hdGNoKVxuICB9XG4gIHJldHVybiBhbGxNYXRjaGVzLm1hcCgoW2Z1bGxdKSA9PiBmdWxsKS5qb2luKCdcXG4nKVxufVxuXG4vKlxuICogUmVhZCBmaWxlLCBwYXJzZSwgdHJhdmVyc2UsIHJlc29sdmUgY2hpbGRyZW4gbW9kdWxlcyBJRHNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENoaWxkcmVuTW9kdWxlSWRzKGZpbGVwYXRoOiBzdHJpbmcsIG9wdGlvbnM6IE9wdGlvbnMgPSB7fSk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgY29uc3QgcmF3ID0gZnMucmVhZEZpbGVTeW5jKGZpbGVwYXRoLCAndXRmLTgnKVxuICBsZXQgY2hpbGRyZW46IHN0cmluZ1tdID0gW11cblxuICB0cnkge1xuICAgIGNoaWxkcmVuID0gKGF3YWl0IHBhcnNlKHJhdykpWzBdLm1hcCgoaSkgPT4gaS5uKSBhcyBzdHJpbmdbXVxuICB9IGNhdGNoIChlKSB7XG4gICAgY2hpbGRyZW4gPSAoYXdhaXQgcGFyc2UoY2xlYW5Db2RlRm9yUGFyc2luZyhyYXcpKSlbMF0ubWFwKChpKSA9PiBpLm4pIGFzIHN0cmluZ1tdXG4gIH1cblxuICByZXR1cm4gY2hpbGRyZW5cbiAgICAubWFwKChjaGlsZEZpbGVwYXRoKSA9PiB7XG4gICAgICBjb25zdCByZXEgPSBjcmVhdGVSZXF1aXJlKGZpbGVwYXRoKVxuICAgICAgbGV0IHJlc29sdmVkXG5cbiAgICAgIHRyeSB7XG4gICAgICAgIHJlc29sdmVkID0gcmVxLnJlc29sdmUoY2hpbGRGaWxlcGF0aClcbiAgICAgIH0gY2F0Y2ggKGUxKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcmVzb2x2ZWQgPSByZXEucmVzb2x2ZShyZXNvbHZlQWxpYXNlcyhjaGlsZEZpbGVwYXRoLCBvcHRpb25zLmFsaWFzKSlcbiAgICAgICAgfSBjYXRjaCAoZTIpIHtcbiAgICAgICAgICByZXNvbHZlZCA9IHJlcXVpcmUucmVzb2x2ZShjaGlsZEZpbGVwYXRoKVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIHNhbWUgc2FtZSwgbXVzdCBiZSBidWlsdC1pbiBtb2R1bGVcbiAgICAgIHJldHVybiByZXNvbHZlZCA9PT0gY2hpbGRGaWxlcGF0aCA/IHVuZGVmaW5lZCA6IHJlc29sdmVkXG4gICAgfSlcbiAgICAuZmlsdGVyKEJvb2xlYW4pIGFzIHN0cmluZ1tdXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB3YWxrKGZpbGVwYXRoOiBzdHJpbmcsIHRyZWU6IFRyZWUsIG9wdGlvbnM6IE9wdGlvbnMgPSB7fSkge1xuICBjb25zdCBpc1dhbGthYmxlID0gL15cXC4oanx0KXN4PyQvLnRlc3QocGF0aC5leHRuYW1lKGZpbGVwYXRoKSlcblxuICB0cmVlW2ZpbGVwYXRoXSA9IHRyZWVbZmlsZXBhdGhdIHx8IHtcbiAgICBlbnRyeTogdHJ1ZSxcbiAgICBwYXJlbnRzOiBbXSxcbiAgICBjaGlsZHJlbjogW10sXG4gIH1cblxuICBjb25zdCBwcmV2Q2hpbGRyZW4gPSB0cmVlW2ZpbGVwYXRoXS5jaGlsZHJlblxuICBjb25zdCBuZXh0Q2hpbGRyZW4gPSBpc1dhbGthYmxlID8gYXdhaXQgZ2V0Q2hpbGRyZW5Nb2R1bGVJZHMoZmlsZXBhdGgsIG9wdGlvbnMpIDogW11cbiAgY29uc3QgcmVtb3ZlZENoaWxkcmVuID0gZGlmZmVyZW5jZShwcmV2Q2hpbGRyZW4sIG5leHRDaGlsZHJlbilcblxuICBmb3IgKGNvbnN0IHJlbW92ZWRDaGlsZCBvZiByZW1vdmVkQ2hpbGRyZW4pIHtcbiAgICB0cmVlW3JlbW92ZWRDaGlsZF0ucGFyZW50cy5zcGxpY2UodHJlZVtyZW1vdmVkQ2hpbGRdLnBhcmVudHMuaW5kZXhPZihmaWxlcGF0aCksIDEpXG5cbiAgICAvLyBpZiBubyBwYXJlbnRzICYgbm90IGFuIGVudHJ5LCByZW1vdmUgdGhpcyBmaWxlIGVudGlyZWx5XG4gICAgaWYgKCF0cmVlW3JlbW92ZWRDaGlsZF0ucGFyZW50cy5sZW5ndGggJiYgIXRyZWVbcmVtb3ZlZENoaWxkXS5lbnRyeSkge1xuICAgICAgcmVtb3ZlKHJlbW92ZWRDaGlsZCwgdHJlZSlcbiAgICB9XG4gIH1cblxuICB0cmVlW2ZpbGVwYXRoXS5jaGlsZHJlbiA9IG5leHRDaGlsZHJlblxuXG4gIGZvciAoY29uc3QgZnAgb2YgdHJlZVtmaWxlcGF0aF0uY2hpbGRyZW4pIHtcbiAgICAvLyBtdXN0IGNyZWF0ZSBhIGxlYWYgZm9yIGVhY2ggY2hpbGQgc28gdGhhdCBlbnRyeSA9IGZhbHNlXG4gICAgdHJlZVtmcF0gPSB0cmVlW2ZwXSB8fCB7XG4gICAgICBlbnRyeTogZmFsc2UsXG4gICAgICBwYXJlbnRzOiBbXSxcbiAgICAgIGNoaWxkcmVuOiBbXSxcbiAgICB9XG5cbiAgICAvLyBleGl0cyBjaXJjdWxhciByZWZzXG4gICAgY29uc3QgYWxyZWFkeVZpc2l0ZWRGcm9tUGFyZW50ID0gdHJlZVtmcF0ucGFyZW50cy5pbmNsdWRlcyhmaWxlcGF0aClcblxuICAgIGlmIChhbHJlYWR5VmlzaXRlZEZyb21QYXJlbnQpIHtcbiAgICAgIGNvbnRpbnVlXG4gICAgfSBlbHNlIHtcbiAgICAgIHRyZWVbZnBdLnBhcmVudHMucHVzaChmaWxlcGF0aClcblxuICAgICAgYXdhaXQgd2FsayhmcCwgdHJlZSwgb3B0aW9ucylcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdHJlZVxufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVtb3ZlKGZpbGVwYXRoOiBzdHJpbmcsIHRyZWU6IFRyZWUpIHtcbiAgY29uc3QgeyBwYXJlbnRzLCBjaGlsZHJlbiB9ID0gdHJlZVtmaWxlcGF0aF1cblxuICBmb3IgKGNvbnN0IGZwIG9mIHBhcmVudHMpIHtcbiAgICB0cmVlW2ZwXS5jaGlsZHJlbi5zcGxpY2UodHJlZVtmcF0uY2hpbGRyZW4uaW5kZXhPZihmaWxlcGF0aCksIDEpXG4gIH1cbiAgZm9yIChjb25zdCBmcCBvZiBjaGlsZHJlbikge1xuICAgIGlmICghdHJlZVtmcF0pIHtcbiAgICAgIC8vIGNoaWxkIG1heSBhbHJlYWR5IGhhdmUgYmVlbiB0YWtlbiBjYXJlIG9mXG4gICAgICBjb250aW51ZVxuICAgIH1cblxuICAgIHRyZWVbZnBdLnBhcmVudHMuc3BsaWNlKHRyZWVbZnBdLnBhcmVudHMuaW5kZXhPZihmaWxlcGF0aCksIDEpXG5cbiAgICAvLyBpZiBubyBwYXJlbnRzLCByZW1vdmUgdGhpcyBmaWxlIGVudGlyZWx5XG4gICAgaWYgKCF0cmVlW2ZwXS5wYXJlbnRzLmxlbmd0aCkge1xuICAgICAgcmVtb3ZlKGZwLCB0cmVlKVxuICAgIH1cbiAgfVxuXG4gIGRlbGV0ZSB0cmVlW2ZpbGVwYXRoXVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY2xlYXJDYWNoZVVwKGZpbGVwYXRoOiBzdHJpbmcsIHRyZWU6IFRyZWUpIHtcbiAgZGVsZXRlIHJlcXVpcmUuY2FjaGVbZmlsZXBhdGhdXG5cbiAgZm9yIChjb25zdCBmcCBvZiB0cmVlW2ZpbGVwYXRoXS5wYXJlbnRzKSB7XG4gICAgY2xlYXJDYWNoZVVwKGZwLCB0cmVlKVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmaW5kVG9wbW9zdFBhcmVudHMoZmlsZXBhdGg6IHN0cmluZywgdHJlZTogVHJlZSwgdmlzaXRlZDogc3RyaW5nW10gPSBbXSk6IHN0cmluZ1tdIHtcbiAgaWYgKHZpc2l0ZWQuaW5jbHVkZXMoZmlsZXBhdGgpKSByZXR1cm4gdmlzaXRlZFxuXG4gIGNvbnN0IHsgZW50cnksIHBhcmVudHMgfSA9IHRyZWVbZmlsZXBhdGhdXG5cbiAgaWYgKGVudHJ5KSB7XG4gICAgdmlzaXRlZC5wdXNoKGZpbGVwYXRoKVxuICB9XG5cbiAgZm9yIChjb25zdCBwYXJlbnQgb2YgcGFyZW50cykge1xuICAgIGZpbmRUb3Btb3N0UGFyZW50cyhwYXJlbnQsIHRyZWUsIHZpc2l0ZWQpXG4gIH1cblxuICByZXR1cm4gdmlzaXRlZFxufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlKG9wdGlvbnM6IE9wdGlvbnMgPSB7fSkge1xuICBsZXQgdHJlZTogVHJlZSA9IHt9XG4gIGNvbnN0IHdhdGNoZXIgPSBmaWxld2F0Y2hlcigpXG4gIGNvbnN0IGVtaXR0ZXIgPSBjcmVhdGVFbWl0dGVyKClcblxuICBmdW5jdGlvbiBoYW5kbGVFcnJvcihlOiBhbnkpIHtcbiAgICBlbWl0dGVyLmVtaXQoJ2Vycm9yJywgZSlcbiAgICBpZiAoIWVtaXR0ZXIubGlzdGVuZXJzKCdlcnJvcicpLmxlbmd0aCkgY29uc29sZS5lcnJvcihlKVxuICB9XG5cbiAgZnVuY3Rpb24gaXNBYnNvbHV0ZVBhdGgoZmlsZXBhdGg6IHN0cmluZykge1xuICAgIGlmICghcGF0aC5pc0Fic29sdXRlKGZpbGVwYXRoKSkge1xuICAgICAgaGFuZGxlRXJyb3IoYENhbm5vdCBhZGQgb3IgcmVtb3ZlIHJlbGF0aXZlIHBhdGggJHtmaWxlcGF0aH1gKVxuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWVcbiAgfVxuXG4gIGFzeW5jIGZ1bmN0aW9uIHdhdGNoRmlsZXBhdGgoZmlsZXBhdGg6IHN0cmluZykge1xuICAgIGNvbnN0IHdhdGNoZWRGaWxlcyA9IHdhdGNoZXIubGlzdCgpXG5cbiAgICBpZiAod2F0Y2hlZEZpbGVzLmluY2x1ZGVzKGZpbGVwYXRoKSkgcmV0dXJuXG5cbiAgICAvKipcbiAgICAgKiB0aGlzIGlzIGFuIGFzeW5jIGZ1bmN0aW9uLCBidXQgb2xkIGVub3VnaCB0aGF0IGFzeW5jIHdhc24ndCBjb21tb25seVxuICAgICAqIGhhbmRsZWQgaW4gbm9kZSwgc28gd2UgbmVlZCB0byBmYWtlIGl0XG4gICAgICpcbiAgICAgKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9mZ25hc3MvZmlsZXdhdGNoZXIvYmxvYi9tYXN0ZXIvaW5kZXguanMjTDM2XG4gICAgICovXG4gICAgd2F0Y2hlci5hZGQoZmlsZXBhdGgpXG5cbiAgICBjb25zdCB0aGVuID0gRGF0ZS5ub3coKVxuXG4gICAgYXdhaXQgbmV3IFByb21pc2UoKHJlcywgcmVqKSA9PiB7XG4gICAgICBjb25zdCBpbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgLypcbiAgICAgICAgICogYWRkZWQgZmlsZXMgbWF5IGIgc2luZ2xlIGVudHJ5LCBidXQgaGF2ZSBjaGlsZCBtb2R1bGVzIHNvIHdlJ3JlIGp1c3RcbiAgICAgICAgICogbG9va2luZyBmb3IgYW4gaW5jcmVhc2UgaW4gdGhlIG92ZXJhbGwgd2F0Y2hlZCBmaWxlIGNvdW50XG4gICAgICAgICAqL1xuICAgICAgICBpZiAod2F0Y2hlci5saXN0KCkubGVuZ3RoID4gd2F0Y2hlZEZpbGVzLmxlbmd0aCkge1xuICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpXG4gICAgICAgICAgcmVzKHRydWUpXG4gICAgICAgIH1cblxuICAgICAgICAvLyB0aW1lb3V0IGFmdGVyIDJzXG4gICAgICAgIGlmIChEYXRlLm5vdygpIC0gdGhlbiA+IDIwMDApIHJlaihmYWxzZSlcbiAgICAgIH0sIDEwKVxuICAgIH0pXG4gIH1cblxuICB3YXRjaGVyLm9uKCdjaGFuZ2UnLCBhc3luYyAoZmlsZTogc3RyaW5nLCBzdGF0OiBhbnkpID0+IHtcbiAgICAvLyBmaXJzdCBjbGVhciBjYWNoZSB1cCB0aGUgdHJlZVxuICAgIGNsZWFyQ2FjaGVVcChmaWxlLCB0cmVlKVxuXG4gICAgaWYgKHN0YXQuZGVsZXRlZCkge1xuICAgICAgY29uc3QgZW50cnkgPSB0cmVlW2ZpbGVdLmVudHJ5XG5cbiAgICAgIGlmIChlbnRyeSkge1xuICAgICAgICBlbWl0dGVyLmVtaXQoJ3JlbW92ZScsIFtmaWxlXSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVtaXR0ZXIuZW1pdCgnY2hhbmdlJywgZmluZFRvcG1vc3RQYXJlbnRzKGZpbGUsIHRyZWUpKVxuICAgICAgfVxuXG4gICAgICB3YXRjaGVyLnJlbW92ZShmaWxlKVxuXG4gICAgICB0cnkge1xuICAgICAgICByZW1vdmUoZmlsZSwgdHJlZSlcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgaGFuZGxlRXJyb3IoZSlcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgcHJldiA9IE9iamVjdC5rZXlzKHRyZWUpXG5cbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIG9uIGNoYW5nZSwgbWFrZSBzdXJlIHRvIHJlLXdhbGsgbGVhZlxuICAgICAgICBhd2FpdCB3YWxrKGZpbGUsIHRyZWUsIG9wdGlvbnMpXG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGhhbmRsZUVycm9yKGUpXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG5leHQgPSBPYmplY3Qua2V5cyh0cmVlKVxuXG4gICAgICAvLyByZW1vdmUgYW55dGhpbmcgdGhhdCBjaGFuZ2VkXG4gICAgICBkaWZmZXJlbmNlKHByZXYsIG5leHQpLmZvckVhY2goKGZpbGVwYXRoKSA9PiB3YXRjaGVyLnJlbW92ZShmaWxlcGF0aCkpXG4gICAgICAvLyB3YXRjaCBhbGwgcGF0aHMsIHdhdGNoRmlsZXBhdGggJiBmaWxld2F0Y2hlciBkZWR1cGVcbiAgICAgIGF3YWl0IFByb21pc2UuYWxsKG5leHQubWFwKHdhdGNoRmlsZXBhdGgpKVxuXG4gICAgICAvLyBhbGVydCBsaXN0ZW5lcnMgb2YgY2hhbmdlIEFGVEVSIGFsbCBvdGhlciBwcm9jZXNzZXNcbiAgICAgIGVtaXR0ZXIuZW1pdCgnY2hhbmdlJywgZmluZFRvcG1vc3RQYXJlbnRzKGZpbGUsIHRyZWUpKVxuICAgIH1cbiAgfSlcblxuICByZXR1cm4ge1xuICAgIGdldCB0cmVlKCkge1xuICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIHRyZWUpXG4gICAgfSxcbiAgICBvbihldmVudDogc3RyaW5nLCBoYW5kbGVyOiBhbnkpIHtcbiAgICAgIHJldHVybiBlbWl0dGVyLm9uKGV2ZW50LCBoYW5kbGVyKVxuICAgIH0sXG4gICAgb25BZGQoaGFuZGxlcjogKGZpbGVzOiBzdHJpbmdbXSkgPT4gdm9pZCkge1xuICAgICAgcmV0dXJuIGVtaXR0ZXIub24oJ2FkZCcsIGhhbmRsZXIpXG4gICAgfSxcbiAgICBvblJlbW92ZShoYW5kbGVyOiAoZmlsZXM6IHN0cmluZ1tdKSA9PiB2b2lkKSB7XG4gICAgICByZXR1cm4gZW1pdHRlci5vbigncmVtb3ZlJywgaGFuZGxlcilcbiAgICB9LFxuICAgIG9uQ2hhbmdlKGhhbmRsZXI6IChmaWxlczogc3RyaW5nW10pID0+IHZvaWQpIHtcbiAgICAgIHJldHVybiBlbWl0dGVyLm9uKCdjaGFuZ2UnLCBoYW5kbGVyKVxuICAgIH0sXG4gICAgb25FcnJvcihoYW5kbGVyOiAoZXJyb3I6IHN0cmluZyB8IEVycm9yKSA9PiB2b2lkKSB7XG4gICAgICByZXR1cm4gZW1pdHRlci5vbignZXJyb3InLCBoYW5kbGVyKVxuICAgIH0sXG4gICAgY2xvc2UoKSB7XG4gICAgICBlbWl0dGVyLmNsZWFyKClcbiAgICAgIHdhdGNoZXIucmVtb3ZlQWxsKClcbiAgICB9LFxuICAgIGFzeW5jIGFkZChmaWxlcGF0aHM6IHN0cmluZyB8IHN0cmluZ1tdKSB7XG4gICAgICBjb25zdCBmaWxlcyA9IChbXSBhcyBzdHJpbmdbXSkuY29uY2F0KGZpbGVwYXRocykuZmlsdGVyKChmcCkgPT4gIXRyZWVbZnBdICYmIGlzQWJzb2x1dGVQYXRoKGZwKSlcblxuICAgICAgaWYgKCFmaWxlcy5sZW5ndGgpIHJldHVyblxuXG4gICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCB3YWxrKGZpbGUsIHRyZWUsIG9wdGlvbnMpXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICBoYW5kbGVFcnJvcihlKVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGF3YWl0IFByb21pc2UuYWxsKE9iamVjdC5rZXlzKHRyZWUpLm1hcCh3YXRjaEZpbGVwYXRoKSlcblxuICAgICAgZW1pdHRlci5lbWl0KCdhZGQnLCBmaWxlcylcbiAgICB9LFxuICAgIHJlbW92ZShmaWxlcGF0aHM6IHN0cmluZyB8IHN0cmluZ1tdKSB7XG4gICAgICBjb25zdCBmaWxlcyA9IChbXSBhcyBzdHJpbmdbXSkuY29uY2F0KGZpbGVwYXRocykuZmlsdGVyKChmcCkgPT4gdHJlZVtmcF0gJiYgaXNBYnNvbHV0ZVBhdGgoZnApKVxuXG4gICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMpIHtcbiAgICAgICAgaWYgKCF0cmVlW2ZpbGVdLmVudHJ5KSBjb250aW51ZVxuXG4gICAgICAgIHJlbW92ZShmaWxlLCB0cmVlKVxuICAgICAgfVxuXG4gICAgICBlbWl0dGVyLmVtaXQoJ3JlbW92ZScsIGZpbGVzKVxuICAgIH0sXG4gIH1cbn1cbiJd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
